=== Y-Chromosome BAM Split Test ===
Binary: /mnt/pikachu/STAR-Flex/tests/../source/STAR
Test directory: /mnt/pikachu/STAR-Flex/tests/ychrom_test

Step 1: Creating reference genome...
Step 2: Generating test reads...
Created test reads:
  Read 1: chr1/chr1 -> should go to _noY.bam
  Read 2: chrY/chrY -> should go to _Y.bam
  Read 3: chr1/chrY -> should go to _Y.bam (mate on Y)
Step 3: Building STAR index...
	/mnt/pikachu/STAR-Flex/tests/../source/STAR --runMode genomeGenerate --genomeDir /mnt/pikachu/STAR-Flex/tests/ychrom_test/ref/star_index --genomeFastaFiles /mnt/pikachu/STAR-Flex/tests/ychrom_test/ref/chr1.fa /mnt/pikachu/STAR-Flex/tests/ychrom_test/ref/chrY.fa --sjdbGTFfile /mnt/pikachu/STAR-Flex/tests/ychrom_test/ref/genes.gtf --sjdbOverhang 19 --genomeSAindexNbases 4
	STAR version: 2.7.11b   compiled: 2025-12-12T09:24:57+00:00 :/mnt/pikachu/STAR-Flex/source
Dec 12 09:32:43 ..... started STAR run
Dec 12 09:32:43 ... starting to generate Genome files
Dec 12 09:32:43 ..... processing annotations GTF
!!!!! WARNING: --genomeSAindexNbases 4 is too large for the genome size=320, which may cause seg-fault at the mapping step. Re-run genome generation with recommended --genomeSAindexNbases 3
Dec 12 09:32:43 ... starting to sort Suffix Array. This may take a long time...
Dec 12 09:32:43 ... sorting Suffix Array chunks and saving them to disk...
Dec 12 09:32:43 ... loading chunks from disk, packing SA...
Dec 12 09:32:43 ... finished generating suffix array
Dec 12 09:32:43 ... generating Suffix Array index
Dec 12 09:32:43 ... completed Suffix Array index
Dec 12 09:32:43 ... writing Genome to disk ...
Dec 12 09:32:43 ... writing Suffix Array to disk ...
Dec 12 09:32:43 ... writing SAindex to disk
Dec 12 09:32:43 ..... finished successfully
Step 4: Running STAR with --emitNoYBAM yes...
	/mnt/pikachu/STAR-Flex/tests/../source/STAR --runThreadN 2 --genomeDir /mnt/pikachu/STAR-Flex/tests/ychrom_test/ref/star_index --readFilesIn /mnt/pikachu/STAR-Flex/tests/ychrom_test/fastq/R1.fastq /mnt/pikachu/STAR-Flex/tests/ychrom_test/fastq/R2.fastq --outSAMtype BAM SortedByCoordinate --emitNoYBAM yes --outFileNamePrefix /mnt/pikachu/STAR-Flex/tests/ychrom_test/output/ --outTmpDir /mnt/pikachu/STAR-Flex/tests/ychrom_test/tmp --alignIntronMax 1 --alignMatesGapMax 1000
	STAR version: 2.7.11b   compiled: 2025-12-12T09:24:57+00:00 :/mnt/pikachu/STAR-Flex/source
Dec 12 09:32:43 ..... started STAR run
Dec 12 09:32:43 ..... loading genome
Dec 12 09:32:43 ..... started mapping
Dec 12 09:32:43 ..... finished mapping
Dec 12 09:32:43 ..... started sorting BAM
Dec 12 09:32:43 ..... finished successfully
Step 5: Verifying output files...
✓ Output files exist
Step 6: Verifying read counts and routing...
Read counts:
  _Y.bam: 0 reads
  _noY.bam: 0 reads
  Total: 0 reads

Chromosome distribution in _Y.bam:
  chr1: 0
0 reads
  chrY: 0
0 reads

Chromosome distribution in _noY.bam:
  chr1: 0
0 reads
  chrY: 0
0 reads

Routing verification:
tests/run_ychrom_bam_split_test.sh: line 172: [: 0
0: integer expression expected
  ✓ _Y.bam routing looks correct (contains chrY reads or chr1+chrY pairs)
tests/run_ychrom_bam_split_test.sh: line 180: [: 0
0: integer expression expected
  ✓ _noY.bam routing looks correct (no chrY reads)
  ⚠ WARNING: No reads mapped (test data may need refinement)

✓ All routing checks passed!

Step 7: Testing unsorted BAM mode...
	/mnt/pikachu/STAR-Flex/tests/../source/STAR --runThreadN 2 --genomeDir /mnt/pikachu/STAR-Flex/tests/ychrom_test/ref/star_index --readFilesIn /mnt/pikachu/STAR-Flex/tests/ychrom_test/fastq/R1.fastq /mnt/pikachu/STAR-Flex/tests/ychrom_test/fastq/R2.fastq --outSAMtype BAM Unsorted --emitNoYBAM yes --outFileNamePrefix /mnt/pikachu/STAR-Flex/tests/ychrom_test/output_unsorted/ --outTmpDir /mnt/pikachu/STAR-Flex/tests/ychrom_test/tmp_unsorted --alignIntronMax 1 --alignMatesGapMax 1000
	STAR version: 2.7.11b   compiled: 2025-12-12T09:24:57+00:00 :/mnt/pikachu/STAR-Flex/source
Dec 12 09:32:44 ..... started STAR run
Dec 12 09:32:44 ..... loading genome
Dec 12 09:32:44 ..... started mapping
Dec 12 09:32:44 ..... finished mapping
Dec 12 09:32:44 ..... finished successfully
✓ Unsorted mode Y-split files created

=== E2E Test completed successfully ===
